<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Laporan Resmi Viskositas Saybolt - Lab Sipil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        body { font-family: 'Inter', sans-serif; background: #1e293b; padding: 20px 0; }
        
        /* Container A4 Standar */
        .paper { 
            width: 210mm; 
            height: 296mm; /* Mengunci tinggi agar pas A4 */
            padding: 12mm; 
            margin: auto; 
            background: white; 
            border-top: 8px solid #1e40af;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .editable-text {
            border-bottom: 1px dashed #cbd5e1;
            padding: 0 5px;
            font-weight: 600;
            color: #1e40af;
            cursor: text;
        }
        .editable-text:focus {
            background: #eff6ff;
            border-bottom: 2px solid #1e40af;
            outline: none;
        }

        .table-container { border: 2px solid #000; margin-top: 5px; }
        table { width: 100%; border-collapse: collapse; }
        th { 
            background: #1e40af; color: white; border: 1px solid #000; 
            padding: 8px 4px; font-size: 10px; text-transform: uppercase;
        }
        td { border: 1px solid #000; padding: 6px; text-align: center; font-size: 11px; }
        
        .input-data { 
            width: 100%; border: none; text-align: center; 
            background: #fffbeb; font-weight: 800; color: #92400e;
        }

        /* Ukuran Grafik Diperkecil agar Muat A4 */
        .chart-frame { 
            margin-top: 15px; border: 2px solid #000; padding: 10px; 
            background: #fff; position: relative;
            background-image: radial-gradient(#cbd5e1 0.5px, transparent 0.5px);
            background-size: 15px 15px;
        }

        @media print { 
            .no-print { display: none !important; } 
            body { background: white; padding: 0; }
            .paper { box-shadow: none; margin: 0; width: 210mm; height: 297mm; } 
        }
    </style>
</head>
<body>

<div class="paper" id="printArea">
    <div class="flex justify-between items-center border-b-4 border-blue-900 pb-3 mb-4">
        <div class="flex items-center gap-3">
            <div class="bg-blue-900 text-white p-2 font-black text-xl italic leading-none">LAB</div>
            <div>
                <h3 class="text-blue-900 font-extrabold text-lg uppercase leading-none">Laboratorium Teknik Sipil</h3>
                <p class="text-[9px] text-gray-500 font-bold tracking-widest mt-1">QUALITY CONTROL & MATERIAL TESTING</p>
            </div>
        </div>
        <div class="text-right text-[10px] space-y-0.5">
            <p>Formulir: <strong>ASTM E-102 / SF-2025</strong></p>
            <div class="flex gap-1 justify-end">
                <span>Tanggal:</span>
                <span contenteditable="true" class="editable-text" id="editDate">19 Desember 2025</span>
            </div>
        </div>
    </div>

    <div class="text-center mb-4">
        <h1 class="text-xl font-black text-gray-900 uppercase underline decoration-blue-900 underline-offset-4">VISKOSITAS BITUMEN KERAS DENGAN ALAT SAYBOLT</h1>
        <h2 class="text-[11px] font-semibold italic text-gray-500 mt-1">( Viscosity of Bituminous Materials )</h2>
    </div>

    <div class="grid grid-cols-2 gap-3 mb-4 text-[11px] bg-gray-50 p-3 border border-gray-200 rounded-lg">
        <div class="space-y-1">
            <div class="flex">
                <span class="w-28 font-bold text-gray-600">Nama Penguji:</span>
                <span contenteditable="true" class="editable-text flex-1" id="editName">Laboran Teknik</span>
            </div>
            <div class="flex">
                <span class="w-28 font-bold text-gray-600">Proyek:</span>
                <span contenteditable="true" class="editable-text flex-1">Peningkatan Jalan Nasional</span>
            </div>
        </div>
        <div class="space-y-1">
            <div class="flex">
                <span class="w-28 font-bold text-gray-600">Lokasi:</span>
                <span contenteditable="true" class="editable-text flex-1">Semarang, Jawa Tengah</span>
            </div>
            <div class="flex">
                <span class="w-28 font-bold text-gray-600">Jenis Aspal:</span>
                <span contenteditable="true" class="editable-text flex-1">AC-WC (Bitumen 60/70)</span>
            </div>
        </div>
    </div>

    <div class="table-container shadow-md">
        <table>
            <thead>
                <tr>
                    <th rowspan="2" class="w-8">No</th>
                    <th rowspan="2">Pembacaan Suhu (°C)</th>
                    <th colspan="2">Percobaan 1</th>
                    <th colspan="2">Percobaan 2</th>
                    <th rowspan="2" class="bg-blue-950">Viskositas Rata-rata</th>
                </tr>
                <tr>
                    <th class="w-24">Waktu (s)</th>
                    <th class="w-28">Viskositas (cSt)</th>
                    <th class="w-24">Waktu (s)</th>
                    <th class="w-28">Viskositas (cSt)</th>
                </tr>
            </thead>
            <tbody id="dataTable"></tbody>
            <tfoot class="bg-gray-100 font-black">
                <tr>
                    <td colspan="2" class="text-right px-4 py-2">RATA - RATA AKHIR</td>
                    <td class="bg-gray-200">-</td>
                    <td id="totV1">0</td>
                    <td class="bg-gray-200">-</td>
                    <td id="totV2">0</td>
                    <td id="totGrand" class="bg-yellow-400 text-blue-900 text-md border-2 border-blue-900">0</td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="chart-frame">
        <canvas id="sayboltChart" style="height: 400px; width: 100%;"></canvas>
    </div>

    <div class="mt-8 flex justify-around text-center font-bold text-[11px]">
        <div class="w-56">
            <p contenteditable="true" class="mb-14 text-gray-600 uppercase underline decoration-dotted">Disetujui Oleh:</p>
            <p contenteditable="true" class="border-t-2 border-black pt-1">Supervisor Laboratorium</p>
        </div>
        <div class="w-56">
            <p contenteditable="true" class="mb-14 text-gray-600 uppercase underline decoration-dotted">Dikerjakan Oleh:</p>
            <p contenteditable="true" class="border-t-2 border-black pt-1" id="displaySigner">Laboran Teknik</p>
        </div>
    </div>
</div>

<div class="fixed bottom-8 right-8 flex flex-col gap-4 no-print">
    <button onclick="autoFill()" class="bg-blue-600 text-white p-4 rounded-full shadow-2xl hover:bg-blue-700 transition-all flex items-center gap-2 font-bold">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
        MUAT DATA
    </button>
    <button onclick="printPDF()" class="bg-red-600 text-white p-4 rounded-full shadow-2xl hover:bg-red-700 transition-all flex items-center gap-2 font-bold">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path></svg>
        SIMPAN PDF
    </button>
</div>

<script>
    const SUHU_DATA = [180, 160, 140, 120];
    const MULT = 2.18;
    let mainChart;

    document.getElementById('editName').addEventListener('input', function() {
        document.getElementById('displaySigner').innerText = this.innerText;
    });

    function init() {
        const table = document.getElementById('dataTable');
        SUHU_DATA.forEach((s, i) => {
            table.innerHTML += `
                <tr>
                    <td>${i+1}</td>
                    <td class="font-bold bg-gray-50 text-gray-800">${s}</td>
                    <td><input type="number" id="t1_${i}" oninput="refresh()" class="input-data" placeholder="0"></td>
                    <td id="v1_${i}" class="text-gray-600"></td>
                    <td><input type="number" id="t2_${i}" oninput="refresh()" class="input-data" placeholder="0"></td>
                    <td id="v2_${i}" class="text-gray-600"></td>
                    <td id="avg_${i}" class="font-black text-blue-900 bg-blue-50/50"></td>
                </tr>
            `;
        });
        renderChart();
    }

    function refresh() {
        let d1=[], d2=[], dAvg=[];
        let s1=0, s2=0, sa=0, n=0;

        SUHU_DATA.forEach((s, i) => {
            let t1 = parseFloat(document.getElementById(`t1_${i}`).value) || 0;
            let t2 = parseFloat(document.getElementById(`t2_${i}`).value) || 0;
            let kv1 = t1 * MULT;
            let kv2 = t2 * MULT;
            let rowAvg = (kv1 > 0 && kv2 > 0) ? (kv1 + kv2) / 2 : (kv1 + kv2);

            document.getElementById(`v1_${i}`).innerText = kv1 ? kv1.toFixed(2) : "";
            document.getElementById(`v2_${i}`).innerText = kv2 ? kv2.toFixed(2) : "";
            document.getElementById(`avg_${i}`).innerText = rowAvg ? rowAvg.toFixed(2) : "";

            if(kv1) { d1.push({x: s, y: kv1}); s1 += kv1; }
            if(kv2) { d2.push({x: s, y: kv2}); s2 += kv2; }
            if(rowAvg) { dAvg.push({x: s, y: rowAvg}); sa += rowAvg; n++; }
        });

        if(n > 0) {
            document.getElementById('totV1').innerText = (s1/n).toFixed(3);
            document.getElementById('totV2').innerText = (s2/n).toFixed(3);
            document.getElementById('totGrand').innerText = (sa/n).toFixed(4);
        }

        mainChart.data.datasets[0].data = dAvg.sort((a,b) => a.x - b.x);
        mainChart.data.datasets[1].data = d1.sort((a,b) => a.x - b.x);
        mainChart.data.datasets[2].data = d2.sort((a,b) => a.x - b.x);
        mainChart.update();
    }

    function renderChart() {
        const ctx = document.getElementById('sayboltChart').getContext('2d');
        mainChart = new Chart(ctx, {
            type: 'line',
            data: {
                datasets: [
                    { label: 'Rata-rata', borderColor: '#ef4444', borderWidth: 3, pointRadius: 5, data: [], tension: 0, fill: false },
                    { label: 'Uji 1', borderColor: '#3b82f6', borderDash: [5,5], data: [], tension: 0, fill: false },
                    { label: 'Uji 2', borderColor: '#10b981', borderDash: [5,5], data: [], tension: 0, fill: false }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        type: 'linear', min: 100, max: 190,
                        title: { display: true, text: 'SUHU PENGUJIAN (°C)', font: { size: 10, weight: 'bold' } },
                        ticks: { stepSize: 15, font: { size: 9, weight: 'bold' } },
                        grid: { color: '#000', lineWidth: 0.5 }
                    },
                    y: {
                        type: 'logarithmic', min: 100, max: 100000,
                        title: { display: true, text: 'VISKOSITAS KINETIK (cSt)', font: { size: 10, weight: 'bold' } },
                        grid: { color: '#94a3b8', lineWidth: 0.2 },
                        ticks: {
                            callback: (v) => [100, 1000, 10000, 100000].includes(v) ? v.toLocaleString() : null,
                            font: { size: 9, weight: 'bold' }
                        }
                    }
                },
                plugins: {
                    legend: { position: 'top', labels: { boxWidth: 12, font: { size: 10, weight: 'bold' } } }
                }
            }
        });
    }

    function autoFill() {
        const csvVals = [[324, 324], [921, 715], [2916, 4476], [5916, 4329]];
        csvVals.forEach((v, i) => {
            document.getElementById(`t1_${i}`).value = v[0];
            document.getElementById(`t2_${i}`).value = v[1];
        });
        refresh();
    }

    function printPDF() {
        const element = document.getElementById('printArea');
        html2pdf().from(element).set({
            margin: 0,
            filename: 'Laporan_Viskositas_Saybolt.pdf',
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { scale: 3, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        }).save();
    }

    window.onload = init;
</script>
</body>
</html>
